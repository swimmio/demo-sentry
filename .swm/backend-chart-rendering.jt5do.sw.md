---
id: jt5do
name: Backend Chart Rendering
file_version: 1.0.2
app_version: 0.8.5-0
file_blobs:
  tests/sentry/charts/test_chartcuterie.py: c468c7a74df6c4aee3b8439081802b287ae5775f
  static/app/chartcuterie/types.tsx: efdd349ea4478ab7303c79f321b59123f49e122d
  static/app/chartcuterie/config.tsx: b7cde5aeb9388b844beca048a51e4391694091b9
  src/sentry/charts/types.py: ab5b8d2b0fb372d08351abd8fdd4d1d902807d5c
---

Sentry's frontend provides users with detailed and interactive charts of various types, highly tailored to the look and feel of the Sentry product.

There are cases where it would be very valuable to show a chart in some context onside of the application. For example:

*   Slack unfurling of Discover charts, Metric Alert notifications, Issue details, or any other link in Sentry where it may be useful to see a chart in Slack.
    
*   Notification and summary emails. Having trends visualized as charts.
    

Fortunately, Sentry has built-in functionality for the internal [Chartcuterie](https://github.com/getsentry/chartcuterie) NodeJS service, which can produce graphs in an image format via an HTTP API. The charts are generated using the same [ECharts](https://github.com/apache/echarts) library that is used on the frontend. Chartcuterie shares code with Sentry's frontend, meaning the look-and-feel of the charts can be easily maintained between the frontend, and charts generated by Chartcuterie on the backend.

<br/>

## **Using Chartcuterie in Sentry's backend**

<br/>

Define the chart's data:
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ tests/sentry/charts/test_chartcuterie.py
```python
â¬œ 23         def test_simple(self, mock_uuid):
â¬œ 24             mock_uuid.return_value = self.get_mock_uuid()
â¬œ 25     
ðŸŸ© 26             chart_data = {
ðŸŸ© 27                 "seriesName": "Discover total period",
ðŸŸ© 28                 "series": [
ðŸŸ© 29                     [1616168400, [{"count": 0}]],
ðŸŸ© 30                     [1616168700, [{"count": 12}]],
ðŸŸ© 31                     [1616169000, [{"count": 13}]],
ðŸŸ© 32                 ],
ðŸŸ© 33             }
â¬œ 34     
â¬œ 35             service_url = "http://chartcuterie"
â¬œ 36             image_data = b"this is png data"
```

<br/>

Then simply use `generate_chart`[<sup id="Z1nWNWo">â†“</sup>](#f-Z1nWNWo), with a `ChartType`[<sup id="2soob6">â†“</sup>](#f-2soob6) and the data.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ tests/sentry/charts/test_chartcuterie.py
```python
â¬œ 46             options = {
â¬œ 47                 "chart-rendering.enabled": True,
â¬œ 48                 "chart-rendering.chartcuterie": {"url": service_url},
â¬œ 49             }
â¬œ 50     
â¬œ 51             # Don't upload our image anywhere
â¬œ 52             with self.options(options):
ðŸŸ© 53                 data = generate_chart(ChartType.SLACK_DISCOVER_TOTAL_PERIOD, chart_data, upload=False)
```

<br/>

## **Configuring charts for rendering**

Chartcuterie loads an external JavaScirpt module from sentry.io which determines how it renders charts. This module directly configures EChart's `options` object, including transformations on the series data provided to Chartcuterie upon a `POST /render` call.

This module lives as part of sentry, and can be found in `ðŸ“„ static/app/chartcuterie/config.tsx`

<br/>

# Adding/removing Chart Types

Chart rendering is configured on a **per "chart type"** basis. For each type of chart you will need to declare a well-known name in the frontend application as well as in the backend charts module.

<br/>

On the frontend add a `ChartType`[<sup id="ZL66ta">â†“</sup>](#f-ZL66ta) , e.g., `SLACK_DISCOVER_TOP5_PERIOD`[<sup id="1JexU5">â†“</sup>](#f-1JexU5) :
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ static/app/chartcuterie/types.tsx
```tsx
ðŸŸ© 10     export enum ChartType {
ðŸŸ© 11       SLACK_DISCOVER_TOTAL_PERIOD = 'slack:discover.totalPeriod',
â¬œ 12       SLACK_DISCOVER_TOTAL_DAILY = 'slack:discover.totalDaily',
â¬œ 13       SLACK_DISCOVER_TOP5_PERIOD = 'slack:discover.top5Period',
â¬œ 14       SLACK_DISCOVER_TOP5_PERIOD_LINE = 'slack:discover.top5PeriodLine',
â¬œ 15       SLACK_DISCOVER_TOP5_DAILY = 'slack:discover.top5Daily',
â¬œ 16       SLACK_DISCOVER_PREVIOUS_PERIOD = 'slack:discover.previousPeriod',
â¬œ 17       SLACK_DISCOVER_WORLDMAP = 'slack:discover.worldmap',
â¬œ 18     }
```

<br/>

Behind the scenes, `register`[<sup id="ZfvnEC">â†“</sup>](#f-ZfvnEC) will be called for the `RenderDescriptor`[<sup id="X2CoB">â†“</sup>](#f-X2CoB) of your chart.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ static/app/chartcuterie/config.tsx
```tsx
â¬œ 33     /**
â¬œ 34      * Register a style descriptor
â¬œ 35      */
â¬œ 36     const register = (renderDescriptor: RenderDescriptor<ChartType>) =>
â¬œ 37       renderConfig.set(renderDescriptor.key, renderDescriptor);
â¬œ 38     
ðŸŸ© 39     discoverCharts.forEach(register);
â¬œ 40     
â¬œ 41     export default config;
â¬œ 42     
```

<br/>

In the backend add a matching `ChartType`[<sup id="Z2clj5C">â†“</sup>](#f-Z2clj5C) :
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/sentry/charts/types.py
```python
â¬œ 4      class ChartType(Enum):
â¬œ 5          """
â¬œ 6          This enum defines the chart styles we can render.
â¬œ 7      
â¬œ 8          This directly maps to the chartcuterie configuration [0] in the frontend
â¬œ 9          code. Be sure to keep these in sync when adding or removing types.
â¬œ 10     
â¬œ 11         [0]: app/chartcuterie/config.tsx.
â¬œ 12         """
â¬œ 13     
ðŸŸ© 14         SLACK_DISCOVER_TOTAL_PERIOD = "slack:discover.totalPeriod"
â¬œ 15         SLACK_DISCOVER_TOTAL_DAILY = "slack:discover.totalDaily"
â¬œ 16         SLACK_DISCOVER_TOP5_PERIOD = "slack:discover.top5Period"
â¬œ 17         SLACK_DISCOVER_TOP5_PERIOD_LINE = "slack:discover.top5PeriodLine"
```

<br/>

Now, deploy your changes in Sentry. The configuration module will automatically propagate to Chartcuterie within a 5 minute window.

You do not need to deploy Chartcuterie.

<br/>

<!-- THIS IS AN AUTOGENERATED SECTION. DO NOT EDIT THIS SECTION DIRECTLY -->
### Swimm Note

<span id="f-Z2clj5C">ChartType</span>[^](#Z2clj5C) - "src/sentry/charts/types.py" L4
```python
class ChartType(Enum):
```

<span id="f-ZL66ta">ChartType</span>[^](#ZL66ta) - "static/app/chartcuterie/types.tsx" L10
```tsx
export enum ChartType {
```

<span id="f-2soob6">ChartType</span>[^](#2soob6) - "tests/sentry/charts/test_chartcuterie.py" L53
```python
            data = generate_chart(ChartType.SLACK_DISCOVER_TOTAL_PERIOD, chart_data, upload=False)
```

<span id="f-Z1nWNWo">generate_chart</span>[^](#Z1nWNWo) - "tests/sentry/charts/test_chartcuterie.py" L53
```python
            data = generate_chart(ChartType.SLACK_DISCOVER_TOTAL_PERIOD, chart_data, upload=False)
```

<span id="f-ZfvnEC">register</span>[^](#ZfvnEC) - "static/app/chartcuterie/config.tsx" L39
```tsx
discoverCharts.forEach(register);
```

<span id="f-X2CoB">RenderDescriptor</span>[^](#X2CoB) - "static/app/chartcuterie/config.tsx" L36
```tsx
const register = (renderDescriptor: RenderDescriptor<ChartType>) =>
```

<span id="f-1JexU5">SLACK_DISCOVER_TOP5_PERIOD</span>[^](#1JexU5) - "static/app/chartcuterie/types.tsx" L13
```tsx
  SLACK_DISCOVER_TOP5_PERIOD = 'slack:discover.top5Period',
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBc2VudHJ5JTNBJTNBc3dpbW1pbw==/docs/jt5do).